# apphosting.yaml

build:
  steps:
    - name: fetch                
      uri: ${SOURCE_TARBALL_URL}

    - name: setup
      entrypoint: bash
      args: ["-lc", "npm ci"]

    - name: build
      entrypoint: bash
      args: ["-lc", "npm run build"]

    - name: bundle
      entrypoint: bash
      args: ["-lc", "cp -R . ${BUILD_DIR}"]

runConfig:
  minInstances: 0
  maxInstances: 20
  concurrency: 100
  cpu: 1
  memoryMiB: 768

env:
  # === Existing Variables ===
  - variable: APIFY_TOKEN
    secret: APIFY_TOKEN
    availability: [RUNTIME]

  - variable: APIFY_APOLLO_ACTOR_ID
    value: code_crafter/apollo-io-scraper
    availability: [RUNTIME]

  - variable: NEXT_PUBLIC_GOOGLE_CLIENT_ID
    value: 1083965020353-50m4ibu3c1f56qc00c5j128bfv0mlk91.apps.googleusercontent.com
    availability: [BUILD, RUNTIME]

  - variable: GOOGLE_CLIENT_SECRET
    secret: GOOGLE_CLIENT_SECRET
    availability: [RUNTIME]

  - variable: NEXT_PUBLIC_SUPABASE_URL
    value: https://yfdelflsheurzaicwayi.supabase.co
    availability: [BUILD, RUNTIME]

  - variable: NEXT_PUBLIC_SUPABASE_ANON_KEY
    secret: NEXT_PUBLIC_SUPABASE_ANON_KEY
    availability: [BUILD, RUNTIME]

  - variable: SUPABASE_SERVICE_ROLE_KEY
    secret: SUPABASE_SERVICE_ROLE_KEY
    availability: [RUNTIME]

  # === ANTON.IA Agent Variables ===
  # App URL for internal API calls
  - variable: NEXT_PUBLIC_APP_URL
    value: https://studio--leadflowai-3yjcy.us-central1.hosted.app
    availability: [BUILD, RUNTIME]

  # Firebase Functions integration for ANTON.IA worker
  - variable: ANTONIA_FIREBASE_TICK_URL
    value: https://us-central1-leadflowai-3yjcy.cloudfunctions.net/antoniaTickHttp
    availability: [RUNTIME]

  - variable: ANTONIA_FIREBASE_TICK_SECRET
    secret: ANTONIA_TICK_SECRET
    availability: [RUNTIME]

  # Cron endpoint protection
  - variable: CRON_SECRET
    secret: ANTONIA_TICK_SECRET
    availability: [RUNTIME]

  # Tracking webhook protection (optional but recommended)
  - variable: TRACKING_WEBHOOK_SECRET
    secret: TRACKING_WEBHOOK_SECRET
    availability: [RUNTIME]
