# apphosting.yaml

build:
  steps:
    - name: fetch                
      uri: ${SOURCE_TARBALL_URL}

    - name: setup
      entrypoint: bash
      args: ["-lc", "npm ci"]

    - name: build
      entrypoint: bash
      args: ["-lc", "npm run build"]

    - name: bundle
      entrypoint: bash
      args: ["-lc", "cp -R . ${BUILD_DIR}"]

runConfig:
  minInstances: 0
  maxInstances: 20
  concurrency: 100
  cpu: 1
  memoryMiB: 768

env:
  # === Existing Variables ===
  - variable: APIFY_TOKEN
    secret: APIFY_TOKEN
    availability: [RUNTIME]

  - variable: APOLLO_API_KEY
    secret: APOLLO_API_KEY
    availability: [RUNTIME]

  - variable: APIFY_APOLLO_ACTOR_ID
    value: code_crafter/apollo-io-scraper
    availability: [RUNTIME]

  - variable: NEXT_PUBLIC_GOOGLE_CLIENT_ID
    value: 1083965020353-50m4ibu3c1f56qc00c5j128bfv0mlk91.apps.googleusercontent.com
    availability: [BUILD, RUNTIME]

  - variable: NEXT_PUBLIC_BASE_URL
    value: https://studio--leadflowai-3yjcy.us-central1.hosted.app
    availability: [BUILD, RUNTIME]

  - variable: NEXT_PUBLIC_AZURE_AD_CLIENT_ID
    value: 3826e4b9-f46e-48b7-aa7c-f06e11bd9686
    availability: [BUILD, RUNTIME]

  - variable: NEXT_PUBLIC_AZURE_AD_TENANT_ID
    value: common
    availability: [BUILD, RUNTIME]

  - variable: NEXT_PUBLIC_AZURE_AD_REDIRECT_URI
    value: https://studio--leadflowai-3yjcy.us-central1.hosted.app/outlook
    availability: [BUILD, RUNTIME]

  - variable: AZURE_AD_CLIENT_SECRET
    secret: AZURE_AD_CLIENT_SECRET
    availability: [RUNTIME]

  - variable: GOOGLE_CLIENT_SECRET
    secret: GOOGLE_CLIENT_SECRET
    availability: [RUNTIME]

  - variable: NEXT_PUBLIC_SUPABASE_URL
    value: https://yfdelflsheurzaicwayi.supabase.co
    availability: [BUILD, RUNTIME]

  - variable: NEXT_PUBLIC_SUPABASE_ANON_KEY
    secret: NEXT_PUBLIC_SUPABASE_ANON_KEY
    availability: [BUILD, RUNTIME]

  - variable: SUPABASE_SERVICE_ROLE_KEY
    secret: SUPABASE_SERVICE_ROLE_KEY
    availability: [RUNTIME]

  - variable: N8N_RESEARCH_WEBHOOK_URL
    secret: N8N_RESEARCH_WEBHOOK_URL
    availability: [RUNTIME]

  - variable: N8N_API_KEY
    secret: N8N_API_KEY
    availability: [RUNTIME]

  - variable: ANYMAIL_FINDER_API_KEY
    secret: ANYMAIL_FINDER_API_KEY
    availability: [RUNTIME]

  - variable: ENRICHMENT_SERVICE_URL
    secret: ENRICHMENT_SERVICE_URL
    availability: [RUNTIME]

  - variable: ENRICHMENT_SERVICE_SECRET
    secret: ENRICHMENT_SERVICE_SECRET
    availability: [RUNTIME]

  - variable: QUOTA_FALLBACK_SECRET
    secret: QUOTA_FALLBACK_SECRET
    availability: [RUNTIME]

  # === ANTON.IA Agent Variables ===
  # App URL for internal API calls
  - variable: NEXT_PUBLIC_APP_URL
    value: https://studio--leadflowai-3yjcy.us-central1.hosted.app
    availability: [BUILD, RUNTIME]

  # Firebase Functions integration for ANTON.IA worker
  - variable: ANTONIA_FIREBASE_TICK_URL
    value: https://antoniatickhttp-2rxibeopja-uc.a.run.app
    availability: [RUNTIME]

  - variable: ANTONIA_FIREBASE_TICK_SECRET
    secret: ANTONIA_TICK_SECRET
    availability: [RUNTIME]

  # Cron endpoint protection
  - variable: CRON_SECRET
    secret: ANTONIA_TICK_SECRET
    availability: [RUNTIME]

  # Tracking webhook protection (optional but recommended)
  - variable: TRACKING_WEBHOOK_SECRET
    secret: TRACKING_WEBHOOK_SECRET
    availability: [RUNTIME]
